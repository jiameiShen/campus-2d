<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>智慧校园-公寓管理</title>
    <link rel="stylesheet" href="../../static/css/home.css" />
    <link rel="stylesheet" href="../../static/css/header.css" />
    <link rel="stylesheet" href="../../static/css/global.css" />
    <link rel="stylesheet" href="../../static/css/page.css" />
    <link rel="stylesheet" href="../../static/css/page-apartment.css" />
    <link href="https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/moment.js/2.29.1/moment-with-locales.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.1.1/echarts.min.js"></script>
    <script src="../../lib/echarts-liquidfill.min.js"></script>
    <script src="../../static/js/home.js"></script>
    <script src="../../static/js/chart.js"></script>
    <style>
      #div2d {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('../../static/image/big-bg.png') no-repeat center top;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <div id="div2d">
      <div class="u-warning-marker animate__animated" id="warning1">
        <div class="u-warning-marker__title">告警</div>
        <div class="u-warning-marker__hd">告警告警</div>
        <div class="u-warning-marker__bd">
          <div class="item">
            <span class="subject">告警告警</span>
            <span class="content">告警告警</span>
          </div>
        </div>
      </div>
      <div class="u-building-marker">
        <div class="caption">南区1号楼</div>
      </div>
      <div class="g-header">
        <div class="left">
          <img class="logo" src="./../../static/image/logo.png" />
          <span class="name">智慧校园</span>
        </div>
        <div class="right">
          <span class="time js-timer"></span>
          <span class="full-screen js-full-screen"></span>
        </div>
      </div>
      <ul class="g-tab-list">
        <li class="tab-item js-tab-item active" data-id="Apartment">公寓管理</li>
        <li class="tab-item js-tab-item" data-id="Energy">能耗管理</li>
        <li class="tab-item js-tab-item" data-id="Asset">资产管理</li>
        <li class="tab-item js-tab-item" data-id="Operations">运维管理</li>
        <li class="tab-item js-tab-item" data-id="Security">安全管理</li>
      </ul>
      <div class="page-container">
        <div class="page-aside page-aside-left animate__animated page-apartment">
          <div class="chart-block chart-basic flex-none">
            <div class="chart-block__hd">
              <p>
                <span class="js-building-name" data-school="学校"></span>概况
              </p>
            </div>
            <div class="chart-block__bd">
              <ul class="list">
                <li class="item item-dormitory">
                  <p><span class="count js-rock-number">14</span>栋</p>
                  <p class="caption">楼栋总数</p>
                </li>
                <li class="item item-room">
                  <p><span class="count js-rock-number">824</span>间</p>
                  <p class="caption">房间总数</p>
                </li>
                <li class="item item-bed">
                  <p><span class="count js-rock-number">24002</span>张</p>
                  <p class="caption">床位总数</p>
                </li>
                <li class="item item-people">
                  <p><span class="count js-rock-number">24002</span>人</p>
                  <p class="caption">入住总数</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="chart-block chart-not-return">
            <div class="chart-block__hd">
              <p><span class="js-building-name"></span>归寝率排行</p>
              <ul class="tab-list" id="notReturnChartButton">
                <li class="tab-item active" data-val="dormitory">楼栋</li>
                <li class="tab-item" data-val="college">院系</li>
              </ul>
            </div>
            <div class="chart-block__bd">
              <div id="notReturnChart"></div>
            </div>
          </div>
          <div class="chart-block chart-abnormal">
            <div class="chart-block__hd">
              <p><span class="js-building-name"></span>异常预警</p>
            </div>
            <div class="chart-block__bd">
              <div id="abnormalWarningChart"></div>
            </div>
          </div>
        </div>
        <div class="page-aside page-aside-right animate__animated page-apartment">
          <div class="chart-block chart-room-usage flex-none">
            <div class="chart-block__hd">
               <p><span class="js-building-name"></span>房间使用率</p>
            </div>
            <div class="chart-block__bd">
              <div id="roomUsageChart" class="left"></div>
              <div class="right">
                <div class="item square-card">
                  <span class="caret-left"></span>
                  <span class="dot"></span>未使用床位<span class="text js-rock-number">752</span>
                  <span class="caret-right"></span>
                </div>
                <div class="item square-card square-card--green">
                  <span class="caret-left"></span>
                  <span class="dot"></span>总床位<span class="text js-rock-number">2367</span>
                  <span class="caret-right"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="chart-block chart-pass">
            <div class="chart-block__hd">
              <p><span class="js-building-name"></span>今日通行人数</p>
              <ul class="label-list">
                <li class="label-item">出：<span id="roomUsageChartOut">0</span></li>
                <li class="label-item">入：<span id="roomUsageChartIn">0</span></li>
              </ul>
            </div>
            <div class="chart-block__bd">
              <div id="passChart"></div>
            </div>
          </div>
          <div class="chart-block chart-intercept">
            <div class="chart-block__hd">
              <p><span class="js-building-name"></span>今日通行拦截</p>
              <ul class="label-list">
                <li class="label-item">总人数：<span id="interceptChartSum">0</span></li>
              </ul>
            </div>
            <div class="chart-block__bd">
              <div id="interceptChart"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    $(function() {
      mockWarning()

      function mockWarning() {
        let parmasArr = [
          {
            id: 1,
            buildingName: '3#教学楼',
            data: [
              {
                subject: '搁置维修单超过预警值',
                content: '89单',
                imgUrl: ''
              }
            ]
          },
          {
            id: 2,
            buildingName: '1#实验楼',
            data: [
              {
                subject: '今日用电超出预警值',
                content: '4.321KW/h',
                imgUrl: ''
              }
            ]
          },
          {
            id: 3,
            buildingName: '图书馆',
            data: [
              {
                subject: '安全布控-黑名单',
                content: '',
                imgUrl: 'https://img.51miz.com/Element/00/88/63/61/7d962719_E886361_53733d01.png'
              }
            ]
          }
        ]
        // 动态添加宿舍楼
        // let object = buildings[2]
        // parmasArr.push({
        //   id: object.userData.dormitoryId,
        //   buildingName: object.userData.name,
        //   data: [
        //     {
        //       subject: '昨日晚归人数',
        //       content: '45人',
        //       imgUrl: ''
        //     },
        //     {
        //       subject: '昨日未归人数',
        //       content: '60人',
        //       imgUrl: ''
        //     }
        //   ]
        // })
        parmasArr.forEach(item => {
          createWarning(item)
        })
        const len = parmasArr.length
        let index = 0
        let timer = setInterval(() => {
          if (index >= len) {
            index = 0
          }
          showWarning(parmasArr[index].id)
          index++
        }, 6000)
      }
      
      function createWarning(params) {
        const template = `
        <div class="u-warning-marker animate__animated" id="warning${params.id}">
          <div class="u-warning-marker__title">告警</div>
          <div class="u-warning-marker__hd">${params.buildingName}</div>
          <div class="u-warning-marker__bd">
            ${params.data.map(item => {
              return `<div class="item">
                <span class="subject">${item.subject}</span>
                <span class="content">
                  ${item.imgUrl ? `<img src="https://img.51miz.com/Element/00/88/63/61/7d962719_E886361_53733d01.png" alt="">` : item.content}
                </span>
              </div>`
            }).join('')}
          </div>
        </div>
        `
        $('#div2d').append($(template))
        // const building = ''
        // app.create({
        //   type: 'UIAnchor',
        //   parent: building,
        //   element: document.getElementById('warning' + params.id),
        //   localPosition: [0, 0, 0],
        //   pivot: [0.5, 1]
        // });
      }

      function showWarning(id) {
        $(`#warning${id}`).show().removeClass('animate__zoomOut').addClass('animate__zoomIn')
        setTimeout(() => {
          $(`#warning${id}`).addClass('animate__zoomOut').removeClass('animate__zoomIn')
        }, 3000)
      }
    })
  </script>
</html>
